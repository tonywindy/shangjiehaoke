<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="description" content="上节好课 - 一点想法，教育智慧金句分享，启发思考，点燃学习热情" />
    <meta name="keywords" content="教育,金句,智慧,学习,启发,教学" />
    <meta name="author" content="上节好课" />
    <title>一点想法 - 上节好课</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* CSS变量定义 */
      :root {
        /* 字体系统 */
        --font-chinese: "Noto Serif SC", "Source Han Serif SC", "LXGW WenKai", serif;
        --font-english: "Georgia", "Times New Roman", "Times", serif;
        
        /* 字体大小 */
        --quote-size-desktop: 2.5rem;
        --quote-size-mobile: 1.8rem;
        --author-size: 1.1rem;
        --button-size: 0.95rem;
        
        /* 行高 */
        --quote-line-height: 1.8;
        --author-line-height: 1.6;
        
        /* 主色调 */
        --bg-primary: #fefefe;
        --bg-secondary: #f8f9fa;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --text-muted: #a0aec0;
        
        /* 强调色 */
        --accent-primary: #2c5aa0;
        --accent-secondary: #2d5016;
        --accent-light: #e2e8f0;
        
        /* 状态色 */
        --success: #38a169;
        --warning: #d69e2e;
        --error: #e53e3e;
        
        /* 动画时长 */
        --transition-fast: 0.3s;
        --transition-normal: 0.6s;
        --transition-slow: 1s;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-chinese);
        background: var(--bg-primary);
        min-height: 100vh;
        color: var(--text-primary);
        line-height: var(--quote-line-height);
        font-display: swap;
      }

      .contact-page {
        min-height: 100vh;
        position: relative;
        overflow: hidden;
      }
      
      .quote-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 80px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        z-index: 2;
        padding-top: 2rem;
      }

      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 16px 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        z-index: 100;
        transition: all var(--transition-fast) ease;
      }

      .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .brand-text {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-primary);
        text-decoration: none;
      }

      .nav-menu {
        display: flex;
        gap: 32px;
        align-items: center;
      }

      .nav-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: all var(--transition-fast) ease;
        position: relative;
        padding: 8px 0;
      }

      .nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--accent-primary);
        transition: width var(--transition-fast) ease;
      }

      .nav-link:hover {
        color: var(--accent-primary);
      }

      .nav-link:hover::after {
        width: 100%;
      }

      /* 金句展示组件 */
      .quote-display {
        text-align: center;
        position: relative;
        margin-bottom: 60px;
        max-width: 100%;
      }
      
      .quote-decorations {
        position: relative;
      }
      
      .quote-mark {
        font-size: 4rem;
        color: var(--accent-primary);
        opacity: 0.6;
        font-family: var(--font-english);
        line-height: 1;
        position: absolute;
        pointer-events: none;
      }
      
      .quote-mark.opening {
        top: 2rem;
        left: -3rem;
      }
      
      .quote-mark.closing {
        top: 2rem;
        right: -3rem;
      }

      .quote-text {
        font-size: clamp(var(--quote-size-mobile), 4vw, var(--quote-size-desktop));
        line-height: var(--quote-line-height);
        color: var(--text-primary);
        margin: 2rem 0;
        font-weight: 400;
        max-width: 100%;
        word-wrap: break-word;
        position: relative;
        z-index: 1;
      }
      
      .quote-footer {
        margin-top: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
      }
      
      .quote-author {
        font-size: var(--author-size);
        color: var(--text-secondary);
        font-style: normal;
        line-height: var(--author-line-height);
        font-weight: 500;
      }
      
      .quote-category {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: var(--accent-light);
        color: var(--accent-secondary);
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* 交互按钮 */
      .action-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
      }
      
      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 25px;
        font-size: var(--button-size);
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-fast) ease;
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--accent-light);
        position: relative;
        overflow: hidden;
      }
      
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(44, 90, 160, 0.2);
        background: var(--accent-primary);
        color: white;
      }
      
      .btn:active {
        transform: translateY(0);
      }
      
      .btn.btn-primary {
        background: var(--accent-primary);
        color: white;
      }
      
      .btn.btn-primary:hover {
        background: #1e3a8a;
      }
      
      .btn.favorited {
        background: var(--success);
        color: white;
      }

      /* 装饰元素 */
      .background-elements {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
      }
      
      .texture-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(circle at 1px 1px, rgba(45, 55, 72, 0.03) 1px, transparent 0);
        background-size: 20px 20px;
        opacity: 0.5;
      }

      /* 动画定义 */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fadeOutDown {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }
      
      .quote-transition-enter {
        animation: fadeInUp var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .quote-transition-exit {
        animation: fadeOutDown var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      /* 意见之箱样式 */
      .feedback-container {
        position: relative;
        display: inline-block;
      }

      .qr-popup {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all var(--transition-fast) ease;
        z-index: 1000;
        border: 1px solid rgba(0, 0, 0, 0.1);
        min-width: 200px;
      }

      .feedback-container:hover .qr-popup {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .qr-popup::before {
        content: '';
        position: absolute;
        top: -8px;
        right: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-bottom: 8px solid white;
      }

      .qr-code {
        width: 150px;
        height: 150px;
        margin: 0 auto 12px;
        display: block;
        border-radius: 8px;
      }

      .qr-text {
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
        line-height: 1.4;
      }

      /* 响应式设计 */
      @media (max-width: 768px) {
        .quote-container {
          padding: 2rem 1rem;
          min-height: calc(100vh - 80px);
        }
        
        .quote-mark.opening {
          left: -1.5rem;
        }
        
        .quote-mark.closing {
          right: -1.5rem;
        }
        
        .action-bar {
          flex-direction: column;
          gap: 1rem;
          width: 100%;
        }
        
        .btn {
          width: 100%;
          padding: 1rem;
          max-width: 280px;
        }
        
        .nav-menu {
          gap: 1rem;
        }
        
        .qr-popup {
          right: -50px;
          min-width: 180px;
        }
        
        .qr-popup::before {
          right: 60px;
        }
      }
      
      @media (max-width: 480px) {
        .quote-container {
          padding: 1rem;
        }
        
        .quote-mark {
          font-size: 3rem;
        }
        
        .quote-mark.opening {
          left: -1rem;
          top: -1.5rem;
        }
        
        .quote-mark.closing {
          right: -1rem;
          bottom: -1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="contact-page">
      <!-- 保留原有导航栏 -->
      <nav class="navbar">
        <div class="nav-container">
          <div class="nav-brand">
            <a href="./index.html" class="brand-text">上节好课</a>
          </div>
          <div class="nav-menu">
            <a href="./index.html" class="nav-link">初见之页</a>
            <a href="./works.html" class="nav-link">些许尝试</a>
            <a href="./contact.html" class="nav-link">一点想法</a>
            <div class="feedback-container">
              <a href="#" class="nav-link">意见之箱</a>
              <div class="qr-popup">
                <img src="./public/erweima.png" alt="公众号二维码" class="qr-code">
                <p class="qr-text">扫码分享您的想法<br>让我们一起成长</p>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- 主内容区 -->
      <main class="quote-container">
        <div class="quote-display">
          <div class="quote-decorations">
            <span class="quote-mark opening">"</span>
            <span class="quote-mark closing">"</span>
          </div>
          
          <blockquote class="quote-text" id="quote-text" role="main" aria-live="polite">
            <!-- 金句内容将通过JavaScript动态加载 -->
          </blockquote>
          
          <footer class="quote-footer">
            <cite class="quote-author" id="quote-author"><!-- 作者 --></cite>
          </footer>
        </div>
        
        <div class="action-bar" role="toolbar" aria-label="金句操作按钮">
          <button class="btn btn-primary" id="btn-random" aria-label="随机获取一句新的金句">换一句</button>
          <button class="btn" id="btn-favorite" aria-label="收藏当前金句">收藏</button>
          <button class="btn" id="btn-download" aria-label="下载金句卡片">下载</button>
        </div>
      </main>
      
      <!-- 背景装饰 -->
      <div class="background-elements">
        <div class="texture-overlay"></div>
      </div>
    </div>

    <!-- 检查文件是否正确加载 -->
    <script>
      // 简单的备用金句数据，以防外部文件加载失败
      window.backupQuotes = [
        {
          id: "001",
          text: "教育的本质不是传授知识，而是点燃火焰。",
          author: "威廉·巴特勒·叶芝",
          category: "education"
        },
        {
          id: "002", 
          text: "学而时习之，不亦说乎？",
          author: "孔子",
          category: "learning"
        },
        {
          id: "003",
          text: "知识就是力量。",
          author: "培根", 
          category: "wisdom"
        }
      ];
      
      // 检查外部文件加载状态
      window.addEventListener('load', function() {
        console.log('页面加载完成');
        console.log('QuotesData 状态:', !!window.QuotesData);
        console.log('QuoteManager 状态:', !!window.QuoteManager);
        
        // 如果外部文件未加载，使用备用数据
        if (!window.QuotesData) {
          console.warn('使用备用金句数据');
          window.QuotesData = { educationQuotes: window.backupQuotes };
        }
      });
    </script>
    
    <!-- 引入数据和管理器 -->
    <script src="./quote-manager.js"></script>
    <script src="./quote-card-generator.js"></script>
    <script>
      // 金句应用主逻辑
      document.addEventListener('DOMContentLoaded', async function() {
        try {
          const response = await fetch('./quotes.json');
          if (!response.ok) {
            throw new Error('金句数据加载失败');
          }
          const quotes = await response.json();
          window.QuotesData = { educationQuotes: quotes };
        } catch (error) {
          console.error(error);
          // 如果加载失败，使用备用数据
          if (!window.QuotesData) {
            console.warn('使用备用金句数据');
            window.QuotesData = { educationQuotes: window.backupQuotes };
          }
        }

        // 检查数据是否加载成功
        console.log('QuotesData:', window.QuotesData);
        console.log('QuoteManager:', window.QuoteManager);
        console.log('QuoteCardGenerator:', window.QuoteCardGenerator);
                
        if (!window.QuotesData || !window.QuotesData.educationQuotes) {
          console.error('金句数据未加载');
          document.getElementById('quote-text').textContent = '数据加载失败，请刷新页面';
          return;
        }
                
        if (!window.QuoteManager) {
          console.error('QuoteManager未加载');
          document.getElementById('quote-text').textContent = 'QuoteManager加载失败';
          return;
        }
                
        // 初始化金句管理器和图片生成器
        const quoteManager = new QuoteManager(window.QuotesData.educationQuotes);
        let cardGenerator = null;
                  
        // 安全地初始化卡片生成器
        try {
          if (window.QuoteCardGenerator) {
            cardGenerator = new QuoteCardGenerator();
            console.log('QuoteCardGenerator 初始化成功');
          } else {
            console.warn('QuoteCardGenerator 未加载，下载功能将不可用');
          }
        } catch (error) {
          console.error('QuoteCardGenerator 初始化失败:', error);
        }
                
        console.log('初始化完成，金句数量:', window.QuotesData.educationQuotes.length);
        
        // DOM 元素引用
        const quoteText = document.getElementById('quote-text');
        const quoteAuthor = document.getElementById('quote-author');
        // const quoteCategory = document.getElementById('quote-category'); // 已删除分类标签
        const btnRandom = document.getElementById('btn-random');
        const btnFavorite = document.getElementById('btn-favorite');
        const btnDownload = document.getElementById('btn-download');
        
        // 显示金句
        function displayQuote(quote) {
          console.log('显示金句:', quote);
          if (!quote) {
            console.error('没有金句数据');
            quoteText.textContent = '没有可显示的金句';
            return;
          }
          
          // 添加退出动画
          quoteText.parentElement.classList.add('quote-transition-exit');
          
          setTimeout(() => {
            quoteText.textContent = quote.text;
            quoteAuthor.textContent = `— ${quote.author}`;
            // quoteCategory.textContent = getCategoryName(quote.category); // 已删除分类显示
            
            // 移除退出动画，添加进入动画
            quoteText.parentElement.classList.remove('quote-transition-exit');
            quoteText.parentElement.classList.add('quote-transition-enter');
            
            // 更新收藏按钮状态
            updateFavoriteButton();
            
            setTimeout(() => {
              quoteText.parentElement.classList.remove('quote-transition-enter');
            }, 600);
          }, 300);
        }
        
        // 获取分类显示名称
        function getCategoryName(category) {
          const names = {
            education: '教育哲学',
            wisdom: '人生智慧', 
            inspiration: '启发思考',
            learning: '学习方法'
          };
          return names[category] || category;
        }
        
        // 更新收藏按钮
        function updateFavoriteButton() {
          const isFavorited = quoteManager.isFavorited();
          btnFavorite.textContent = isFavorited ? '已收藏' : '收藏';
          btnFavorite.classList.toggle('favorited', isFavorited);
        }
        
        // 事件监听器
        btnRandom.addEventListener('click', () => {
          btnRandom.classList.add('loading');
          setTimeout(() => {
            const newQuote = quoteManager.nextQuote();
            displayQuote(newQuote);
            btnRandom.classList.remove('loading');
          }, 100);
        });
        
        btnFavorite.addEventListener('click', () => {
          quoteManager.toggleFavorite();
          updateFavoriteButton();
        });
        

        
        // 下载功能
        btnDownload.addEventListener('click', async () => {
          // 检查是否有卡片生成器
          if (!cardGenerator) {
            alert('图片生成功能未加载，无法下载卡片');
            return;
          }
          
          if (!window.ImageUtils || !window.ImageUtils.isSupported()) {
            alert('您的浏览器不支持图片生成功能');
            return;
          }
          
          const currentQuote = quoteManager.getCurrentQuote();
          if (!currentQuote) {
            alert('没有可下载的金句');
            return;
          }
          
          btnDownload.classList.add('loading');
          btnDownload.textContent = '生成中...';
          
          try {
            const success = await cardGenerator.generateAndDownload(currentQuote);
            if (success) {
              // 下载成功反馈
              btnDownload.textContent = '下载成功!';
              setTimeout(() => {
                btnDownload.textContent = '下载';
                btnDownload.classList.remove('loading');
              }, 2000);
            } else {
              throw new Error('生成失败');
            }
          } catch (error) {
            console.error('下载失败:', error);
            alert('图片生成失败，请稍后重试');
            btnDownload.textContent = '下载';
            btnDownload.classList.remove('loading');
          }
        });
        
        // 初始显示
        const initialQuote = quoteManager.getCurrentQuote();
        console.log('初始金句:', initialQuote);
        displayQuote(initialQuote);
        
        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
          if (e.code === 'Space' && !e.target.matches('input, textarea, button')) {
            e.preventDefault();
            btnRandom.click();
          }
        });
      });
    </script>
  </body>
</html>